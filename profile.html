<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Profile - LoveMap</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/components.css">
</head>
<body>
  <!-- SVG Icon Gradients -->
  <svg class="svg-defs">
    <defs>
      <linearGradient id="navGradient" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
        <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
      </linearGradient>
    </defs>
  </svg>

  <div class="app-header">
    <div class="header-content">
      <h1 class="header-title">My Profile</h1>
    </div>
  </div>

  <div class="profile-container">
    <!-- Tab Navigation -->
    <div class="tab-nav">
      <button class="tab-btn active" onclick="switchTab('edit-profile', this)">Edit Profile</button>
      <button class="tab-btn" onclick="switchTab('settings', this)">Settings</button>
    </div>

    <!-- Edit Profile Tab -->
    <div id="edit-profile" class="tab-content active">
      <!-- User Avatar Section -->
      <div class="profile-section">
        <div class="profile-card">
          <div class="profile-avatar" id="userAvatar">YU</div>
          <button class="btn btn-secondary" style="margin-top: 16px; max-width: 200px; margin-left: auto; margin-right: auto;">
            Edit Photo
          </button>
        </div>
      </div>

      <!-- Edit Profile Form -->
      <div class="profile-section">
        <form id="editProfileForm">
          <div class="form-group">
            <label for="editName">Name</label>
            <input 
              type="text" 
              id="editName" 
              class="form-input" 
              placeholder="Your name"
              required
            >
          </div>

          <div class="form-group">
            <label for="editAge">Age</label>
            <input 
              type="number" 
              id="editAge" 
              class="form-input" 
              placeholder="Your age"
              min="18"
              max="99"
              required
            >
          </div>

          <div class="form-group">
            <label for="editBio">Bio</label>
            <textarea 
              id="editBio" 
              class="form-input form-textarea" 
              placeholder="Tell us about yourself"
              rows="4"
            ></textarea>
          </div>

          <div class="form-group">
            <label for="editInterests">Interests (comma separated)</label>
            <input 
              type="text" 
              id="editInterests" 
              class="form-input" 
              placeholder="e.g., Hiking, Coffee, Travel"
            >
          </div>

          <button type="submit" class="btn btn-primary">
            Save Changes
          </button>
        </form>
      </div>

      <!-- Activity Stats -->
      <div class="profile-section">
        <h2>Activity</h2>
        
        <div class="setting-item">
          <div>
            <div class="setting-label">Likes Given</div>
            <div class="setting-value" id="likesGiven">0</div>
          </div>
        </div>

        <div class="setting-item">
          <div>
            <div class="setting-label">Matches</div>
            <div class="setting-value" id="matchCount">0</div>
          </div>
        </div>

        <div class="setting-item">
          <div>
            <div class="setting-label">Profile Views</div>
            <div class="setting-value">Coming soon</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Tab -->
    <div id="settings" class="tab-content">
      <!-- Search Preferences -->
      <div class="profile-section">
        <h2>Search Preferences</h2>
        
        <div class="form-group">
          <label for="searchRadius">Search Radius</label>
          <input 
            type="range" 
            id="searchRadius" 
            class="radius-slider radius-slider-container"
            min="1" 
            max="50" 
            value="5" 
            step="1"
            oninput="updateRadiusDisplay()"
          >
          <div class="setting-value radius-display" id="currentRadius">5 km</div>
        </div>
      </div>

      <!-- Account Settings -->
      <div class="profile-section">
        <h2>Account</h2>
        
        <div class="setting-item">
          <div>
            <div class="setting-label">Email</div>
            <div class="setting-value" id="userEmail">Not set</div>
          </div>
        </div>

        <div class="setting-item">
          <div>
            <div class="setting-label">Privacy Settings</div>
            <div class="setting-value">Public profile</div>
          </div>
        </div>

        <div class="setting-item">
          <div>
            <div class="setting-label">Notifications</div>
            <div class="setting-value">Enabled</div>
          </div>
        </div>
      </div>

      <!-- Account Actions -->
      <div class="profile-section">
        <h2>Account Actions</h2>
        
        <button class="btn btn-secondary mb-2" onclick="handleChangePassword()">
          Change Password
        </button>
        
        <button class="btn btn-secondary mb-2" onclick="handleLogout()">
          Logout
        </button>
        
        <button class="btn btn-danger" onclick="handleDeleteAccount()">
          Delete Account
        </button>
      </div>
    </div>
  </div>

  <!-- Navigation Bar -->
  <nav class="nav-bar">
    <a href="map.html" class="nav-item">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
        <circle cx="12" cy="10" r="3"></circle>
      </svg>
      <small>Map</small>
    </a>
    <a href="chats.html" class="nav-item">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
      </svg>
      <small>Chats</small>
    </a>
    <a href="notifications.html" class="nav-item" style="position: relative;">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
      </svg>
      <small>Notifications</small>
      <span class="nav-badge" id="notificationBadge" style="display: none;">0</span>
    </a>
    <a href="profile.html" class="nav-item active">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
      <small>Profile</small>
    </a>
  </nav>

  <script src="js/app.js"></script>
  <script>
    // Check authentication
    checkAuth();

    // Tab switching function
    function switchTab(tabId, button) {
      // Remove active class from all tabs and content
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      // Add active class to clicked tab and corresponding content
      button.classList.add('active');
      document.getElementById(tabId).classList.add('active');
    }

    // Load user profile data
    function loadProfile() {
      const userName = localStorage.getItem('userName') || 'Guest User';
      const userAge = localStorage.getItem('userAge') || '25';
      const userEmail = localStorage.getItem('userEmail') || 'Not set';
      const userBio = localStorage.getItem('userBio') || 'No bio yet';
      const userInterests = localStorage.getItem('userInterests') || '';
      
      // Helper function to get initials safely
      function getInitials(name) {
        const parts = name.trim().split(/\s+/).filter(part => part.length > 0);
        if (parts.length === 0) return 'GU';
        return parts.map(n => n[0]).join('').toUpperCase().substring(0, 2);
      }
      
      const initials = getInitials(userName);

      // Update profile display
      document.getElementById('userAvatar').textContent = initials;
      document.getElementById('userEmail').textContent = userEmail;

      // Update edit form
      document.getElementById('editName').value = userName;
      document.getElementById('editAge').value = userAge;
      document.getElementById('editBio').value = userBio;
      document.getElementById('editInterests').value = userInterests;

      // Update stats
      const likes = JSON.parse(localStorage.getItem('likes') || '[]');
      const matches = JSON.parse(localStorage.getItem('matches') || '[]');
      document.getElementById('likesGiven').textContent = likes.length;
      document.getElementById('matchCount').textContent = matches.length;
      
      // Update radius display
      const radius = localStorage.getItem('searchRadius') || '5';
      document.getElementById('searchRadius').value = radius;
      updateRadiusDisplay();
    }

    // Handle profile edit form
    document.getElementById('editProfileForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const name = document.getElementById('editName').value;
      const age = document.getElementById('editAge').value;
      const bio = document.getElementById('editBio').value;
      const interests = document.getElementById('editInterests').value;

      // Save to localStorage
      localStorage.setItem('userName', name);
      localStorage.setItem('userAge', age);
      localStorage.setItem('userBio', bio);
      localStorage.setItem('userInterests', interests);

      // Reload profile
      loadProfile();

      // Show success message
      alert('Profile updated successfully!');
    });

    // Update radius display
    function updateRadiusDisplay() {
      const radius = document.getElementById('searchRadius').value;
      document.getElementById('currentRadius').textContent = radius + ' km';
      localStorage.setItem('searchRadius', radius);
    }

    // Handle change password
    function handleChangePassword() {
      alert('Change password functionality coming soon!');
    }

    // Handle logout
    function handleLogout() {
      if (confirm('Are you sure you want to logout?')) {
        logout();
      }
    }

    // Handle delete account
    function handleDeleteAccount() {
      if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
        if (confirm('This will permanently delete all your data. Are you absolutely sure?')) {
          logout();
          alert('Account deleted successfully.');
        }
      }
    }

    // Update notification badge
    function updateNotificationBadge() {
      const badge = document.getElementById('notificationBadge');
      const count = getUnreadNotificationsCount();
      
      if (count > 0) {
        badge.textContent = count;
        badge.style.display = 'block';
      } else {
        badge.style.display = 'none';
      }
    }

    // Initialize
    loadProfile();
    updateNotificationBadge();
  </script>
</body>
</html>
